{% extends 'base.html' %}
{% block title %}Live Chats{% endblock %}
{% block content %}
<section class="container" style="max-width:1100px">
  <h1 style="margin-bottom:10px">Live Chats</h1>
  <p style="margin-top:0;color:var(--muted)">Real‑time conversations initiated by visitors. Open chats first.</p>
  <div class="cards-grid" style="grid-template-columns:repeat(auto-fit,minmax(240px,1fr));margin-top:30px">
    {% for c in chats %}
    <div class="card" style="position:relative;padding:20px;display:flex;flex-direction:column;gap:8px">
      <div style="font-weight:600;font-size:1.05rem;display:flex;align-items:center;gap:8px">
        <span style="padding:4px 10px;border-radius:20px;background:rgba(34,197,94,.15);font-size:.75rem;letter-spacing:.5px;text-transform:uppercase">#{{ c.id }}</span>
        <span>{{ c.name or 'Visitor' }}</span>
      </div>
      <div style="font-size:.8rem;color:var(--muted)">SID: {{ c.sid or '—' }}</div>
      <div style="display:flex;align-items:center;gap:6px;font-size:.75rem">
        {% if c.status == 'open' %}
        <span style="padding:4px 8px;border-radius:8px;background:rgba(34,197,94,.18);color:var(--brand)">{{ c.status }}</span>
        {% else %}
        <span style="padding:4px 8px;border-radius:8px;background:rgba(255,255,255,.08);color:var(--muted)">{{ c.status }}</span>
        {% endif %}
        <span style="color:var(--muted)">Last: {{ c.last_activity|uk_datetime }}</span>
      </div>
      <a href="{{ url_for('admin_chat_view', chat_id=c.id) }}" class="btn ghost" style="margin-top:4px;padding:10px 14px">Open</a>
      {% if c.status!='closed' %}
      <form method="post" action="{{ url_for('admin_chat_close', chat_id=c.id) }}" style="margin-top:4px">
        <button class="btn" style="background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;padding:10px 14px" type="submit">Close Chat</button>
      </form>
      {% endif %}
    </div>
    {% else %}
    <p>No chats yet.</p>
    {% endfor %}
  </div>
</section>
{% endblock %}