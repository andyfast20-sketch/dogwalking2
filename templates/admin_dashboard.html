{% extends 'base.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block extra_head %}
<style>
  .admin-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:24px;max-width:1100px;margin:40px auto;padding:0 clamp(20px,5vw,60px)}
  .admin-card{background:linear-gradient(180deg,rgba(16,185,129,.08),rgba(16,185,129,.03));border:2px solid rgba(16,185,129,.25);border-radius:20px;padding:32px;cursor:pointer;transition:all .35s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}
  .admin-card::before{content:'';position:absolute;top:0;right:0;width:120px;height:120px;background:radial-gradient(circle,rgba(34,197,94,.2),transparent 70%);pointer-events:none}
  .admin-card:hover{transform:translateY(-6px);box-shadow:0 20px 60px rgba(16,185,129,.3),0 8px 30px rgba(0,0,0,.5);border-color:var(--brand)}
  .admin-card-icon{font-size:3rem;margin-bottom:16px}
  .admin-card h2{margin:0 0 8px;font-size:1.5rem;background:linear-gradient(135deg,var(--brand),var(--accent-light));-webkit-background-clip:text;background-clip:text;color:transparent}
  .admin-card p{color:var(--muted);margin:0;font-size:.95rem;line-height:1.6}
  .admin-section{display:none;max-width:1200px;margin:0 auto;padding:20px clamp(20px,5vw,60px)}
  .admin-section.active{display:block}
  .admin-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
  .admin-header h1{margin:0}
  .back-btn{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.16);color:var(--text);padding:10px 20px;border-radius:12px;cursor:pointer;font-weight:600;transition:all .25s}
  .back-btn:hover{background:rgba(255,255,255,.12);transform:translateX(-4px)}
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
  .admin-section.active{animation:fadeIn .4s ease}
</style>
{% endblock %}
{% block content %}
<section class="container" style="text-align:center;padding-top:40px">
  <h1 style="margin-bottom:12px">Admin Dashboard</h1>
  <p style="color:var(--muted);margin-top:0;margin-bottom:0">Select a section to manage</p>
</section>

<!-- Dashboard Cards -->
<div id="dashboard-cards" class="admin-grid">
  <div class="admin-card" onclick="showSection('chats')">
    <div class="admin-card-icon">üí¨</div>
    <h2>Live Chat Console</h2>
    <p>View and respond to visitor chats in real-time. Manage active conversations and support requests.</p>
  </div>
  
  <div class="admin-card" onclick="showSection('enquiries')">
    <div class="admin-card-icon">üì¨</div>
    <h2>Enquiries</h2>
    <p>Review all contact form submissions, track status, and manage customer inquiries.</p>
  </div>
  
  <div class="admin-card" onclick="showSection('visitors')">
    <div class="admin-card-icon">üë•</div>
    <h2>Visitors Analytics</h2>
    <p>Track visitor activity, analyze behavior patterns, and gain insights into site traffic.</p>
  </div>
</div>

<!-- Live Chats Section -->
<div id="section-chats" class="admin-section">
  <div class="admin-header">
    <h1>Live Chat Console</h1>
    <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
  </div>
  <div id="chats-content"></div>
</div>

<!-- Enquiries Section -->
<div id="section-enquiries" class="admin-section">
  <div class="admin-header">
    <h1>Enquiries</h1>
    <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
  </div>
  <div id="enquiries-content"></div>
</div>

<!-- Visitors Section -->
<div id="section-visitors" class="admin-section">
  <div class="admin-header">
    <h1>Visitors Analytics</h1>
    <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
  </div>
  <div id="visitors-content"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function showSection(name){
  // Hide dashboard cards
  document.getElementById('dashboard-cards').style.display='none';
  document.querySelector('.container').style.display='none';
  
  // Show section
  const section = document.getElementById('section-'+name);
  section.classList.add('active');
  
  // Load content
  const contentDiv = document.getElementById(name+'-content');
  try{
    let url;
    if(name==='chats') url='/admin/chats';
    else if(name==='enquiries') url='/admin/enquiries';
    else if(name==='visitors') url='/admin/visitors';
    
    const r = await fetch(url);
    const html = await r.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    const content = doc.querySelector('.container') || doc.querySelector('section');
    if(content) contentDiv.innerHTML = content.innerHTML;
    
    // Start polling for chats
    if(name==='chats'){
      if(window.chatPollTimer) clearInterval(window.chatPollTimer);
      window.chatPollTimer = setInterval(async ()=>{
        const r2 = await fetch('/admin/chats');
        const html2 = await r2.text();
        const doc2 = new DOMParser().parseFromString(html2, 'text/html');
        const grid = doc2.querySelector('.cards-grid');
        const currentGrid = contentDiv.querySelector('.cards-grid');
        if(grid && currentGrid && grid.innerHTML !== currentGrid.innerHTML){
          currentGrid.innerHTML = grid.innerHTML;
        }
      }, 3000);
    }
  }catch(e){
    contentDiv.innerHTML='<p style="color:var(--muted)">Error loading content.</p>';
  }
}

function showDashboard(){
  // Stop polling
  if(window.chatPollTimer) clearInterval(window.chatPollTimer);
  
  // Hide all sections
  document.querySelectorAll('.admin-section').forEach(s=>s.classList.remove('active'));
  
  // Show dashboard
  document.getElementById('dashboard-cards').style.display='grid';
  document.querySelector('.container').style.display='block';
}
</script>
{% endblock %}
