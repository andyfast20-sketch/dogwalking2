<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Happy Paws Dog Walking{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  {% block extra_head %}{% endblock %}
</head>
<body>
  {% if maintenance_mode %}
  <!-- Maintenance Mode Banner -->
  <div style="background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;text-align:center;padding:16px 20px;font-weight:700;letter-spacing:.5px;font-size:1rem;box-shadow:0 4px 12px rgba(0,0,0,.3);position:relative;z-index:1000;border-bottom:3px solid #991b1b">
    <div style="max-width:1180px;margin:0 auto;display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap">
      <span style="font-size:1.5rem">‚ö†Ô∏è</span>
      <span>WEBSITE IS UNDER CONSTRUCTION - DO NOT PLACE ANY BOOKINGS</span>
      <span style="font-size:1.5rem">‚ö†Ô∏è</span>
    </div>
  </div>
  {% endif %}
  <header class="site-header">
    <div class="header-inner">
      <div class="logo-wrap">
        <div class="logo">üêæ Happy Paws</div>
        <img class="header-avatar" src="{{ url_for('static', filename='img/andy.jpg') }}" alt="Profile photo" width="44" height="44" loading="eager" decoding="async" fetchpriority="high" onerror="this.onerror=null;this.classList.add('fallback');this.src='https://image.pollinations.ai/prompt/portrait%20photo%20of%20friendly%20professional%20dog%20walker%20male%2C%20smiling%2C%20natural%20light%2C%20studio%20background%2C%20clean%2C%20modern?width=200&height=200&nologo=true'" />
      </div>
      <nav class="main-nav">
        <a href="{{ url_for('home') }}" class="{% if request.endpoint == 'home' %}active{% endif %}">Home</a>
        <a href="{{ url_for('about') }}" class="{% if request.endpoint == 'about' %}active{% endif %}">About</a>
        <a href="{{ url_for('services') }}" class="{% if request.endpoint == 'services' %}active{% endif %}">Services</a>
        <a href="{{ url_for('book') }}" class="cta-link {% if request.endpoint == 'book' %}active{% endif %}">Book a Walk</a>
        <a href="{{ url_for('gallery') }}" class="{% if request.endpoint == 'gallery' %}active{% endif %}">Gallery</a>
        <a href="{{ url_for('contact') }}" class="{% if request.endpoint == 'contact' %}active{% endif %}">Contact</a>
      </nav>
    </div>
  </header>
  <main>
    {% block content %}{% endblock %}
  </main>
  <footer class="site-footer">
    <p>&copy; {{ 2025 }} Happy Paws Dog Walking. All rights reserved.</p>
  </footer>
  
  <!-- Floating chat button -->
  <button id="chat-launch" type="button" aria-label="Open live chat" title="Live Chat" style="position:fixed;bottom:24px;right:24px;width:64px;height:64px;border-radius:50%;font-size:2rem;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#22c55e,#13894b);color:#fff;border:none;z-index:1000;box-shadow:0 8px 32px -8px rgba(34,197,94,.7);cursor:pointer;transition:transform .25s">üí¨</button>
  
  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  <script>
  // Floating chat widget (front-end)
  (function(){
    const btn=document.getElementById('chat-launch');
    if(!btn) return;
    let panel; let chatId=null; let lastId=0; let pollTimer;
    function buildPanel(){
      panel=document.createElement('div');
      panel.className='chat-panel';
      panel.innerHTML=`<div class="chat-header"><strong>Live Chat</strong><button type="button" class="chat-close" aria-label="Close chat">√ó</button></div>
      <div class="chat-messages" aria-live="polite"></div>
      <form class="chat-form" autocomplete="off">
        <div class="chat-row"><input name="message" required placeholder="Type your message" class="chat-input" /><button class="chat-send" type="submit">Send</button></div>
      </form>`;
      document.body.appendChild(panel);
      panel.querySelector('.chat-close').addEventListener('click',closePanel);
      panel.querySelector('.chat-form').addEventListener('submit',onSend);
    }
    async function ensureChat(){
      if(chatId) return chatId;
      const data=new URLSearchParams();
      const r=await fetch('/chat/start',{method:'POST',body:data});
      const j=await r.json(); if(j.ok) chatId=j.chat_id; return chatId;
    }
    function append(sender,text){
      const wrap=panel.querySelector('.chat-messages');
      const row=document.createElement('div'); row.className='msg msg-'+sender;
      row.textContent=text; wrap.appendChild(row); wrap.scrollTop=wrap.scrollHeight;
    }
    async function poll(){
      if(!chatId) return; try{
        const r=await fetch(`/chat/poll/${chatId}?after=${lastId}`); const j=await r.json();
        if(j && j.messages){ for(const m of j.messages){ append(m.sender,m.message); lastId=m.id; } }
      }catch(e){}
    }
    async function onSend(e){
      e.preventDefault(); const form=e.target; const inp=form.querySelector('.chat-input'); const msg=inp.value.trim(); if(!msg) return;
      await ensureChat();
      append('user',msg); inp.value='';
      const data=new URLSearchParams({chat_id:String(chatId),message:msg,sender:'user'});
      fetch('/chat/send',{method:'POST',body:data}).catch(()=>{});
    }
    function openPanel(){ if(!panel) buildPanel(); panel.classList.add('open'); ensureChat(); if(!pollTimer){ pollTimer=setInterval(poll,1800); poll(); } }
    function closePanel(){ if(panel){ panel.classList.remove('open'); } }
    btn.addEventListener('click',openPanel);
  })();
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>